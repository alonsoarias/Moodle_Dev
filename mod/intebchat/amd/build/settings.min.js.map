{"version":3,"file":"settings.min.js","sources":["../src/settings.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Settings page JavaScript\n *\n * @module     mod_intebchat/settings\n * @copyright  2025 Alonso Arias <soporte@ingeweb.co>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine(['jquery', 'core/ajax', 'core/notification'], function($, Ajax, Notification) {\n    var init = function() {\n        // Handle global settings API type change\n        $('#id_s_mod_intebchat_type').on('change', function(e) {\n            // If the API Type is changed, programmatically hit save so the page automatically reloads with the new options\n            $('.settingsform').addClass('mod_intebchat');\n            $('.settingsform').addClass('disabled');\n            $('.settingsform button[type=\"submit\"]').click();\n        });\n\n        // Handle instance form API key change for assistant list update\n        var $apikeyField = $('#id_apikey');\n        var $assistantSelect = $('#id_assistant');\n        var $apitypeSelect = $('#id_apitype');\n        \n        if ($apikeyField.length && $assistantSelect.length) {\n            var updateAssistantList = function() {\n                var apikey = $apikeyField.val();\n                var apitype = $apitypeSelect.val() || $apitypeSelect.find('input[type=\"hidden\"]').val();\n                \n                if (apikey && apitype === 'assistant') {\n                    // Show loading indicator\n                    $assistantSelect.prop('disabled', true);\n                    \n                    Ajax.call([{\n                        methodname: 'mod_intebchat_get_assistants',\n                        args: {apikey: apikey},\n                        done: function(response) {\n                            // Clear current options\n                            $assistantSelect.empty();\n                            \n                            if (response.assistants && response.assistants.length > 0) {\n                                $.each(response.assistants, function(index, assistant) {\n                                    $assistantSelect.append(\n                                        $('<option></option>')\n                                            .attr('value', assistant.id)\n                                            .text(assistant.name)\n                                    );\n                                });\n                            } else {\n                                $assistantSelect.append(\n                                    $('<option></option>')\n                                        .attr('value', '')\n                                        .text('No assistants found')\n                                );\n                            }\n                            \n                            $assistantSelect.prop('disabled', false);\n                        },\n                        fail: function(error) {\n                            Notification.addNotification({\n                                message: 'Failed to fetch assistants: ' + error.message,\n                                type: 'error'\n                            });\n                            $assistantSelect.prop('disabled', false);\n                        }\n                    }]);\n                }\n            };\n            \n            // Update assistants when API key changes\n            $apikeyField.on('blur', updateAssistantList);\n            \n            // Update visibility when API type changes\n            $apitypeSelect.on('change', function() {\n                if ($(this).val() === 'assistant') {\n                    updateAssistantList();\n                }\n            });\n        }\n\n        // Handle form validation for API-specific fields\n        $('form.mform').on('submit', function(e) {\n            var apitype = $('#id_apitype').val() || $('#id_apitype').find('input[type=\"hidden\"]').val();\n            var hasErrors = false;\n            \n            // Validate Azure fields if Azure is selected\n            if (apitype === 'azure') {\n                if (!$('#id_resourcename').val()) {\n                    $('#id_error_resourcename').text('Required').show();\n                    hasErrors = true;\n                }\n                if (!$('#id_deploymentid').val()) {\n                    $('#id_error_deploymentid').text('Required').show();\n                    hasErrors = true;\n                }\n            }\n            \n            if (hasErrors) {\n                e.preventDefault();\n                return false;\n            }\n        });\n\n        // Alert when a reasoning model is selected\n        var $modelSelect = $('#id_model');\n        if ($modelSelect.length) {\n            // Check initial value\n            var checkReasoningModel = function(val) {\n                if (val && (val.includes('o1') || val.includes('o3'))) {\n                    return true;\n                }\n                return false;\n            };\n\n            // Function to show reasoning model alert\n            var showReasoningModelAlert = function(modelName) {\n                Notification.addNotification({\n                    message: 'Has seleccionado el modelo \"' + modelName + '\". Este es un modelo de razonamiento avanzado dise침ado para resolver problemas complejos mediante un an치lisis paso a paso. Ten en cuenta que puede tener un mayor costo y tiempo de respuesta.',\n                    type: 'info'\n                });\n            };\n\n            // Check on change\n            $modelSelect.on('change', function() {\n                var val = $(this).val();\n                if (checkReasoningModel(val)) {\n                    showReasoningModelAlert(val);\n                }\n            });\n\n            // Also check on initial load if editing\n            var initialVal = $modelSelect.val();\n            if (initialVal && checkReasoningModel(initialVal)) {\n                // Don't show alert on initial load, just be ready for changes\n            }\n        }\n\n        // Also handle for global settings model select\n        var $globalModelSelect = $('#id_s_mod_intebchat_model');\n        if ($globalModelSelect.length) {\n            $globalModelSelect.on('change', function() {\n                var val = $(this).val();\n                if (val && (val.includes('o1') || val.includes('o3'))) {\n                    Notification.addNotification({\n                        message: 'Has seleccionado el modelo \"' + val + '\". Este es un modelo de razonamiento avanzado dise침ado para resolver problemas complejos mediante un an치lisis paso a paso. Ten en cuenta que puede tener un mayor costo y tiempo de respuesta.',\n                        type: 'info'\n                    });\n                }\n            });\n        }\n    };\n\n    return {\n        init: init\n    };\n});"],"names":["define","$","Ajax","Notification","init","on","e","addClass","click","$apikeyField","$assistantSelect","$apitypeSelect","length","updateAssistantList","apikey","val","apitype","find","prop","call","methodname","args","done","response","empty","assistants","each","index","assistant","append","attr","id","text","name","fail","error","addNotification","message","type","this","hasErrors","show","preventDefault","$modelSelect","checkReasoningModel","includes","modelName","initialVal","$globalModelSelect"],"mappings":";;;;;;;AAuBAA,gCAAO,CAAC,SAAU,YAAa,sBAAsB,SAASC,EAAGC,KAAMC,oBA+I5D,CACHC,KA/IO,WAEPH,EAAE,4BAA4BI,GAAG,UAAU,SAASC,GAEhDL,EAAE,iBAAiBM,SAAS,iBAC5BN,EAAE,iBAAiBM,SAAS,YAC5BN,EAAE,uCAAuCO,eAIzCC,aAAeR,EAAE,cACjBS,iBAAmBT,EAAE,iBACrBU,eAAiBV,EAAE,kBAEnBQ,aAAaG,QAAUF,iBAAiBE,OAAQ,KAC5CC,oBAAsB,eAClBC,OAASL,aAAaM,MACtBC,QAAUL,eAAeI,OAASJ,eAAeM,KAAK,wBAAwBF,MAE9ED,QAAsB,cAAZE,UAEVN,iBAAiBQ,KAAK,YAAY,GAElChB,KAAKiB,KAAK,CAAC,CACPC,WAAY,+BACZC,KAAM,CAACP,OAAQA,QACfQ,KAAM,SAASC,UAEXb,iBAAiBc,QAEbD,SAASE,YAAcF,SAASE,WAAWb,OAAS,EACpDX,EAAEyB,KAAKH,SAASE,YAAY,SAASE,MAAOC,WACxClB,iBAAiBmB,OACb5B,EAAE,qBACG6B,KAAK,QAASF,UAAUG,IACxBC,KAAKJ,UAAUK,UAI5BvB,iBAAiBmB,OACb5B,EAAE,qBACG6B,KAAK,QAAS,IACdE,KAAK,wBAIlBtB,iBAAiBQ,KAAK,YAAY,IAEtCgB,KAAM,SAASC,OACXhC,aAAaiC,gBAAgB,CACzBC,QAAS,+BAAiCF,MAAME,QAChDC,KAAM,UAEV5B,iBAAiBQ,KAAK,YAAY,SAOlDT,aAAaJ,GAAG,OAAQQ,qBAGxBF,eAAeN,GAAG,UAAU,WACF,cAAlBJ,EAAEsC,MAAMxB,OACRF,yBAMZZ,EAAE,cAAcI,GAAG,UAAU,SAASC,OAE9BkC,WAAY,KAGA,WAJFvC,EAAE,eAAec,OAASd,EAAE,eAAegB,KAAK,wBAAwBF,SAK7Ed,EAAE,oBAAoBc,QACvBd,EAAE,0BAA0B+B,KAAK,YAAYS,OAC7CD,WAAY,GAEXvC,EAAE,oBAAoBc,QACvBd,EAAE,0BAA0B+B,KAAK,YAAYS,OAC7CD,WAAY,IAIhBA,iBACAlC,EAAEoC,kBACK,SAKXC,aAAe1C,EAAE,gBACjB0C,aAAa/B,OAAQ,KAEjBgC,oBAAsB,SAAS7B,cAC3BA,MAAQA,IAAI8B,SAAS,QAAS9B,IAAI8B,SAAS,QAenDF,aAAatC,GAAG,UAAU,eARayC,UAS/B/B,IAAMd,EAAEsC,MAAMxB,MACd6B,oBAAoB7B,OAVW+B,UAWP/B,IAV5BZ,aAAaiC,gBAAgB,CACzBC,QAAS,+BAAiCS,UAAY,iMACtDR,KAAM,iBAaVS,WAAaJ,aAAa5B,MAC1BgC,YAAcH,oBAAoBG,gBAMtCC,mBAAqB/C,EAAE,6BACvB+C,mBAAmBpC,QACnBoC,mBAAmB3C,GAAG,UAAU,eACxBU,IAAMd,EAAEsC,MAAMxB,MACdA,MAAQA,IAAI8B,SAAS,OAAS9B,IAAI8B,SAAS,QAC3C1C,aAAaiC,gBAAgB,CACzBC,QAAS,+BAAiCtB,IAAM,iMAChDuB,KAAM"}