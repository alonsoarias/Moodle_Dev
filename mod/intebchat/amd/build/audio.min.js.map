{"version":3,"file":"audio.min.js","sources":["../src/audio.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\r\n//\r\n// Moodle is free software: you can redistribute it and/or modify\r\n// it under the terms of the GNU General Public License as published by\r\n// the Free Software Foundation, either version 3 of the License, or\r\n// (at your option) any later version.\r\n//\r\n// Moodle is distributed in the hope that it will be useful,\r\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n// GNU General Public License for more details.\r\n//\r\n// You should have received a copy of the GNU General Public License\r\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\r\n\r\n/**\r\n * Audio recording utilities extracted from local_geniai plugin.\r\n *\r\n * @module     mod_intebchat/audio\r\n * @copyright  2024 Eduardo Kraus\r\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\r\n */\r\n\r\ndefine(['jquery'], function ($) {\r\n    return {\r\n        init: function (mode) {\r\n            var chunks = [];\r\n            var mediaRecorder = null;\r\n            var audioMode = mode || 'text';\r\n\r\n            function reset() {\r\n                $('#intebchat-icon-mic').removeClass('recording').show();\r\n                $('#intebchat-icon-stop').hide();\r\n                $('#intebchat-recorded-audio').val('');\r\n            }\r\n\r\n            $('#intebchat-icon-mic').on('click', function () {\r\n                reset();\r\n                if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {\r\n                    alert('Your browser does not support recording!');\r\n                    return;\r\n                }\r\n                navigator.mediaDevices.getUserMedia({ audio: true }).then(function (stream) {\r\n                    mediaRecorder = new MediaRecorder(stream);\r\n                    mediaRecorder.start();\r\n                    $('#intebchat-icon-mic').addClass('recording').hide();\r\n                    $('#intebchat-icon-stop').show();\r\n                    mediaRecorder.ondataavailable = function (e) { chunks.push(e.data); };\r\n                    mediaRecorder.onstop = function () {\r\n                        var reader = new FileReader();\r\n                        reader.readAsDataURL(new Blob(chunks, { type: 'audio/mp3' }));\r\n                        reader.onloadend = function () {\r\n                            $('#intebchat-recorded-audio').val(reader.result);\r\n                            // Trigger auto send only for pure audio mode\r\n                            if (audioMode === 'audio') {\r\n                                $('#intebchat-icon-stop').trigger('audio-ready');\r\n                            }\r\n                        };\r\n                        chunks = [];\r\n                    };\r\n                }).catch(function (err) {\r\n                    alert(err);\r\n                    reset();\r\n                });\r\n            });\r\n\r\n            $('#intebchat-icon-stop').on('click', function () {\r\n                if (mediaRecorder) {\r\n                    mediaRecorder.stop();\r\n                    mediaRecorder = null;\r\n                }\r\n                $('#intebchat-icon-mic').show().removeClass('recording');\r\n                $('#intebchat-icon-stop').hide();\r\n            });\r\n        }\r\n    };\r\n});"],"names":["define","$","init","mode","chunks","mediaRecorder","audioMode","reset","removeClass","show","hide","val","on","navigator","mediaDevices","getUserMedia","audio","then","stream","MediaRecorder","start","addClass","ondataavailable","e","push","data","onstop","reader","FileReader","readAsDataURL","Blob","type","onloadend","result","trigger","catch","err","alert","stop"],"mappings":";;;;;;;AAuBAA,6BAAO,CAAC,WAAW,SAAUC,SAClB,CACHC,KAAM,SAAUC,UACRC,OAAS,GACTC,cAAgB,KAChBC,UAAYH,MAAQ,gBAEfI,QACLN,EAAE,uBAAuBO,YAAY,aAAaC,OAClDR,EAAE,wBAAwBS,OAC1BT,EAAE,6BAA6BU,IAAI,IAGvCV,EAAE,uBAAuBW,GAAG,SAAS,WACjCL,QACKM,UAAUC,cAAiBD,UAAUC,aAAaC,aAIvDF,UAAUC,aAAaC,aAAa,CAAEC,OAAO,IAAQC,MAAK,SAAUC,SAChEb,cAAgB,IAAIc,cAAcD,SACpBE,QACdnB,EAAE,uBAAuBoB,SAAS,aAAaX,OAC/CT,EAAE,wBAAwBQ,OAC1BJ,cAAciB,gBAAkB,SAAUC,GAAKnB,OAAOoB,KAAKD,EAAEE,OAC7DpB,cAAcqB,OAAS,eACfC,OAAS,IAAIC,WACjBD,OAAOE,cAAc,IAAIC,KAAK1B,OAAQ,CAAE2B,KAAM,eAC9CJ,OAAOK,UAAY,WACf/B,EAAE,6BAA6BU,IAAIgB,OAAOM,QAExB,UAAd3B,WACAL,EAAE,wBAAwBiC,QAAQ,gBAG1C9B,OAAS,OAEd+B,OAAM,SAAUC,KACfC,MAAMD,KACN7B,WAvBA8B,MAAM,+CA2BdpC,EAAE,wBAAwBW,GAAG,SAAS,WAC9BP,gBACAA,cAAciC,OACdjC,cAAgB,MAEpBJ,EAAE,uBAAuBQ,OAAOD,YAAY,aAC5CP,EAAE,wBAAwBS"}