define("paygw_payu/payment_modal",["exports","core/templates","core/modal","core/ajax","core/notification"],(function(_exports,_templates,_modal,_ajax,_notification){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}
/**
   * PayU payment gateway modal handler.
   *
   * @module     paygw_payu/payment_modal
   * @copyright  2024 Orion Cloud Consulting SAS
   * @author     Alonso Arias <soporte@orioncloud.com.co>
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.process=_exports.formatPhoneNumber=void 0,_templates=_interopRequireDefault(_templates),_modal=_interopRequireDefault(_modal),_ajax=_interopRequireDefault(_ajax),_notification=_interopRequireDefault(_notification);_exports.process=(component,paymentArea,itemId,description)=>showPaymentModal(component,paymentArea,itemId,description).then((modal=>(handlePaymentMethod(modal),modal))).catch(_notification.default.exception);const showPaymentModal=async(component,paymentArea,itemId,description)=>{const templateContext={component:component,paymentarea:paymentArea,itemid:itemId,description:description,sesskey:M.cfg.sesskey};try{const banks=await loadPSEBanks();templateContext.banks=banks}catch(error){console.error("Error loading PSE banks:",error)}const modal=await _modal.default.create({title:M.util.get_string("gatewayname","paygw_payu"),body:await _templates.default.render("paygw_payu/checkout_modal",templateContext),large:!0,show:!0,removeOnClose:!0});return modal.setFooter(await _templates.default.render("paygw_payu/modal_footer",{})),modal},loadPSEBanks=()=>_ajax.default.call([{methodname:"paygw_payu_get_pse_banks",args:{}}])[0],handlePaymentMethod=modal=>{const root=modal.getRoot(),form=root.find("#payu-checkout-form"),methodSelect=form.find("#paymentmethod");methodSelect.on("change",(function(){const method=$(this).val();form.find(".payment-method-fields").addClass("d-none"),form.find('.payment-method-fields[data-method="'+method+'"]').removeClass("d-none"),updateRequiredFields(form,method)})),methodSelect.trigger("change"),form.on("submit",(function(e){e.preventDefault(),submitPayment(form,modal)})),root.find("#payu-submit-payment").on("click",(function(){form.submit()}))},updateRequiredFields=(form,method)=>{switch(form.find("[required]").removeAttr("required"),method){case"creditcard":form.find("#cardholder, #cardnumber, #expmonth, #expyear, #cvv").attr("required",!0);break;case"pse":form.find("#psebank, #documentnumber").attr("required",!0);break;case"nequi":case"bancolombia":form.find("#phone").attr("required",!0);break;case"googlepay":form.find("#gp_token").attr("required",!0);break;case"cash":form.find("#documentnumber").attr("required",!0)}},submitPayment=async(form,modal)=>{if(form[0].checkValidity()){modal.getRoot().find("#payu-submit-payment").prop("disabled",!0).html(M.util.get_string("processingpayment","paygw_payu"));try{const formData={};form.serializeArray().forEach((field=>{formData[field.name]=field.value}));const response=await _ajax.default.call([{methodname:"paygw_payu_process_payment",args:formData}])[0];if(!response.success)throw new Error(response.message||"Payment failed");response.redirect_url?window.location.href=response.redirect_url:response.receipt_url?(window.open(response.receipt_url,"_blank"),modal.destroy(),window.location.reload()):(modal.destroy(),window.location.reload())}catch(error){_notification.default.addNotification({type:"error",message:error.message||M.util.get_string("paymenterror","paygw_payu")}),modal.getRoot().find("#payu-submit-payment").prop("disabled",!1).html(M.util.get_string("submitpayment","paygw_payu"))}}else form[0].reportValidity()};_exports.formatPhoneNumber=phone=>((phone=phone.replace(/\D/g,"")).startsWith("57")&&(phone=phone.substring(2)),10!==phone.length?null:phone.startsWith("3")?"57 "+phone:null)}));

//# sourceMappingURL=payment_modal.min.js.map