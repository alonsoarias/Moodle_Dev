/**
 * Module filter for download center
 *
 * @module     local_downloadcenter/modfilter
 * @copyright  2025 Original: Academic Moodle Cooperation
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("local_downloadcenter/modfilter",["core/str","core/url"],(function(Str,Url){const ModFilter=function(modnames){const instance=this;this.modnames=modnames,this.strings={},this.formid=null,this.currentlyshown=!1,this.modlist=null,Str.get_strings([{key:"all",component:"moodle"},{key:"none",component:"moodle"},{key:"select",component:"moodle"},{key:"showtypes",component:"backup"},{key:"hidetypes",component:"backup"}]).done((function(strs){instance.strings.all=strs[0],instance.strings.none=strs[1],instance.strings.select=strs[2],instance.strings.showtypes=strs[3],instance.strings.hidetypes=strs[4],instance.init()}))};return ModFilter.prototype.init=function(){const instance=this,firstsection=document.querySelector('div[role="main"] > form .card.block');if(!firstsection)return;instance.formid=firstsection.closest("form").id;const showTypeOptionsLink='<span class="font-weight-bold ml-3 text-nowrap">(<a id="downloadcenter-bytype" href="#">'+instance.strings.showtypes+"</a>)</span>";let html=instance.htmlGenerator("included",instance.strings.select),links=document.createElement("div");links.className="grouped_settings section_level block card",links.innerHTML=html,links.querySelector(".downloadcenter_selector .col-md-9").insertAdjacentHTML("beforeend",showTypeOptionsLink),firstsection.parentNode.insertBefore(links,firstsection),instance.modlist=document.createElement("div"),instance.modlist.id="mod_select_links",instance.modlist.className="m-l-2",instance.modlist.style.display="none",links.appendChild(instance.modlist);for(let mod in instance.modnames){if(!instance.modnames.hasOwnProperty(mod))continue;const img='<img src="'+Url.imageUrl("icon","mod_"+mod)+'" class="activityicon" />';html=instance.htmlGenerator("mod_"+mod,img+instance.modnames[mod]);const modlinks=document.createElement("div");modlinks.className="grouped_settings section_level",modlinks.innerHTML=html,instance.modlist.appendChild(modlinks),instance.initlinks(modlinks,mod)}const allIncluded=document.getElementById("downloadcenter-all-included");allIncluded&&allIncluded.addEventListener("click",(function(e){instance.helper(e,!0,"item_")}));const noneIncluded=document.getElementById("downloadcenter-none-included");noneIncluded&&noneIncluded.addEventListener("click",(function(e){instance.helper(e,!1,"item_")}));const byType=document.getElementById("downloadcenter-bytype");byType&&byType.addEventListener("click",(function(e){e.preventDefault(),instance.toggletypes()})),document.querySelectorAll("input.form-check-input").forEach((function(checkbox){checkbox.addEventListener("click",(function(){instance.checkboxhandler(this),instance.updateFormState()}))}))},ModFilter.prototype.checkboxhandler=function(checkbox){const name=checkbox.name,checked=checkbox.checked;if("item_"===name.substring(0,"item_".length)){let parent=checkbox.closest(".card");if("item_topic"===name.substring(0,"item_topic".length))parent.querySelectorAll("input.form-check-input").forEach((function(input){input.checked=checked}));else if(checked){const topicCheckbox=parent.querySelector('input.form-check-input[name^="item_topic"]');topicCheckbox&&(topicCheckbox.checked=!0)}}},ModFilter.prototype.updateFormState=function(){this.formid&&M.form&&M.form.updateFormState&&M.form.updateFormState(this.formid)},ModFilter.prototype.toggletypes=function(){const link=document.getElementById("downloadcenter-bytype");this.currentlyshown?(link.textContent=this.strings.showtypes,this.modlist.style.display="none"):(link.textContent=this.strings.hidetypes,this.modlist.style.display="block"),this.currentlyshown=!this.currentlyshown},ModFilter.prototype.initlinks=function(links,mod){const instance=this,allModLink=document.getElementById("downloadcenter-all-mod_"+mod);allModLink&&allModLink.addEventListener("click",(function(e){instance.helper(e,!0,"item_",mod)}));const noneModLink=document.getElementById("downloadcenter-none-mod_"+mod);noneModLink&&noneModLink.addEventListener("click",(function(e){instance.helper(e,!1,"item_",mod)}))},ModFilter.prototype.helper=function(e,check,type,mod){e.preventDefault();let prefix="";void 0!==mod&&(prefix="item_"+mod+"_");const len=type.length;document.querySelectorAll('input[type="checkbox"]').forEach((function(checkbox){const name=checkbox.name;if((!prefix||name.substring(0,prefix.length)===prefix)&&(name.substring(0,len)===type&&(checkbox.checked=check),check)){const firstCheckbox=checkbox.closest(".card.block").querySelector('.fitem:first-child input[type="checkbox"]');firstCheckbox&&(firstCheckbox.checked=check)}})),this.updateFormState()},ModFilter.prototype.htmlGenerator=function(idtype,heading){let links='<a id="downloadcenter-all-'+idtype+'" href="#">'+this.strings.all+"</a> / ";return links+='<a id="downloadcenter-none-'+idtype+'" href="#">'+this.strings.none+"</a>",this.rowGenerator(heading,links)},ModFilter.prototype.rowGenerator=function(heading,content){let ret='<div class="form-group row fitem downloadcenter_selector">';return ret+='<div class="col-md-3"></div>',ret+='<div class="col-md-9">',ret+='<label><span class="itemtitle">'+heading+"</span></label>",ret+='<span class="text-nowrap">'+content+"</span>",ret+="</div>",ret+="</div>",ret},{init:function(modnames){return new ModFilter(modnames)}}}));

//# sourceMappingURL=modfilter.min.js.map