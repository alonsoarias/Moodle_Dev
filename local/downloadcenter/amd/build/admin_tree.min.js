/**
 * Admin category/course/resource selector logic.
 *
 * @module     local_downloadcenter/admin_tree
 * @copyright  2025 Alonso Arias <soporte@ingeweb.co>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("local_downloadcenter/admin_tree",["jquery"],(function($){const triggerChange=function(element){if("function"==typeof window.Event)element.dispatchEvent(new Event("change",{bubbles:!1}));else{const event=document.createEvent("HTMLEvents");event.initEvent("change",!1,!1),element.dispatchEvent(event)}},updateFullCourseFlag=function(courseNode,enabled){const fullCourseInput=courseNode.querySelector(".course-fullcourse-flag");fullCourseInput&&(fullCourseInput.disabled=!enabled)},updateCourseState=function(courseNode){const courseCheckbox=courseNode.querySelector("summary .course-checkbox");if(!courseCheckbox)return;const resourceCheckboxes=Array.from(courseNode.querySelectorAll(".resource-checkbox:not([data-fullcourse])")),fallbackCheckbox=courseNode.querySelector(".resource-checkbox[data-fullcourse]");if(!(resourceCheckboxes.length>0))return void(fallbackCheckbox?(courseCheckbox.checked=fallbackCheckbox.checked,courseCheckbox.indeterminate=!1,updateFullCourseFlag(courseNode,fallbackCheckbox.checked)):(courseCheckbox.checked=!1,courseCheckbox.indeterminate=!1,updateFullCourseFlag(courseNode,!1)));const checkedCount=resourceCheckboxes.filter((function(checkbox){return checkbox.checked})).length;0===checkedCount?(courseCheckbox.checked=!1,courseCheckbox.indeterminate=!1,updateFullCourseFlag(courseNode,!1)):checkedCount===resourceCheckboxes.length?(courseCheckbox.checked=!0,courseCheckbox.indeterminate=!1,updateFullCourseFlag(courseNode,!0)):(courseCheckbox.checked=!0,courseCheckbox.indeterminate=!0,updateFullCourseFlag(courseNode,!1))},updateCategoryState=function(categoryNode){const categoryCheckbox=categoryNode.querySelector("summary .category-checkbox");if(!categoryCheckbox)return;const resourceCheckboxes=categoryNode.querySelectorAll(".resource-checkbox");if(!resourceCheckboxes.length)return categoryCheckbox.checked=!1,void(categoryCheckbox.indeterminate=!1);let checkedCount=0;resourceCheckboxes.forEach((function(checkbox){checkbox.checked&&checkedCount++})),0===checkedCount?(categoryCheckbox.checked=!1,categoryCheckbox.indeterminate=!1):checkedCount===resourceCheckboxes.length?(categoryCheckbox.checked=!0,categoryCheckbox.indeterminate=!1):(categoryCheckbox.checked=!0,categoryCheckbox.indeterminate=!0)},updateCategoryAncestors=function(categoryNode){let parent=categoryNode.parentElement?categoryNode.parentElement.closest(".downloadcenter-category"):null;for(;parent;)updateCategoryState(parent),parent=parent.parentElement?parent.parentElement.closest(".downloadcenter-category"):null};return{init:function(){$(document).ready((function(){document.querySelectorAll(".downloadcenter-course").forEach((function(courseNode){!function(courseNode){const courseCheckbox=courseNode.querySelector("summary .course-checkbox"),resourceCheckboxes=Array.from(courseNode.querySelectorAll(".resource-checkbox"));courseCheckbox&&courseCheckbox.addEventListener("change",(function(){resourceCheckboxes.forEach((function(checkbox){checkbox.checked=courseCheckbox.checked,triggerChange(checkbox)})),updateCourseState(courseNode);const categoryNode=courseNode.closest(".downloadcenter-category");categoryNode&&(updateCategoryState(categoryNode),updateCategoryAncestors(categoryNode))})),resourceCheckboxes.forEach((function(checkbox){checkbox.addEventListener("change",(function(){updateCourseState(courseNode);const categoryNode=courseNode.closest(".downloadcenter-category");categoryNode&&(updateCategoryState(categoryNode),updateCategoryAncestors(categoryNode))}))})),updateCourseState(courseNode)}(courseNode)})),document.querySelectorAll(".downloadcenter-category").forEach((function(categoryNode){!function(categoryNode){const categoryCheckbox=categoryNode.querySelector("summary .category-checkbox");categoryCheckbox&&categoryCheckbox.addEventListener("change",(function(){const container=categoryNode.querySelector(".category-children");container&&container.querySelectorAll('input[type="checkbox"]').forEach((function(checkbox){checkbox.checked=categoryCheckbox.checked,triggerChange(checkbox)})),updateCategoryState(categoryNode),updateCategoryAncestors(categoryNode)})),updateCategoryState(categoryNode),updateCategoryAncestors(categoryNode)}(categoryNode)}))}))}}}));

//# sourceMappingURL=admin_tree.min.js.map