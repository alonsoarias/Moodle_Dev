{"version":3,"file":"search.min.js","sources":["../src/search.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\r\n//\r\n// Moodle is free software: you can redistribute it and/or modify\r\n// it under the terms of the GNU General Public License as published by\r\n// the Free Software Foundation, either version 3 of the License, or\r\n// (at your option) any later version.\r\n//\r\n// Moodle is distributed in the hope that it will be useful,\r\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n// GNU General Public License for more details.\r\n//\r\n// You should have received a copy of the GNU General Public License\r\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\r\n\r\n/**\r\n * Search functionality for download center\r\n *\r\n * @module     local_downloadcenter/search\r\n * @copyright  2025 Original: Academic Moodle Cooperation\r\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\r\n */\r\ndefine(['jquery'], function($) {\r\n\r\n    const IDENTIFIERS = {\r\n        SEARCHINPUT: 'downloadcenter-search-input',\r\n        FORM: '#region-main form.mform',\r\n        FORMELEMENTS: '.fitem',\r\n        TOPICS: '.card.block',\r\n        CHECKBOX: 'input[type=\"checkbox\"]',\r\n        TITLE: 'label .itemtitle span:not(.badge)',\r\n        RESULTSHOLDER: 'downloadcenter-search-results',\r\n        RESULTSCOUNT: 'downloadcenter-search-results-count',\r\n        SEARCHCLEAR: '#downloadcenter-search-clear'\r\n    };\r\n\r\n    const allCmsPerTopic = [];\r\n    let resultsHolder = null;\r\n    let resultsCount = null;\r\n    let searchClearBtn = null;\r\n    let searchInput = null;\r\n\r\n    const search = function(searchValue) {\r\n        const showAll = searchValue.length === 0;\r\n        let resultscount = 0;\r\n        \r\n        allCmsPerTopic.forEach(topic => {\r\n            let foundInTopic = false;\r\n            topic.cms.forEach(cm => {\r\n                if (cm.title.indexOf(searchValue) > -1 || showAll) {\r\n                    foundInTopic = true;\r\n                    resultscount++;\r\n                    cm.visible = true;\r\n                    cm.elem.classList.remove('d-none');\r\n                } else {\r\n                    cm.visible = false;\r\n                    cm.elem.classList.add('d-none');\r\n                }\r\n            });\r\n            \r\n            if (foundInTopic) {\r\n                topic.visible = true;\r\n                topic.elem.classList.remove('d-none');\r\n            } else {\r\n                topic.visible = false;\r\n                topic.elem.classList.add('d-none');\r\n            }\r\n        });\r\n        \r\n        if (!showAll) {\r\n            resultsCount.textContent = resultscount;\r\n            resultsHolder.classList.remove('d-none');\r\n            searchClearBtn.classList.remove('d-none');\r\n        } else {\r\n            resultsHolder.classList.add('d-none');\r\n            searchClearBtn.classList.add('d-none');\r\n        }\r\n    };\r\n\r\n    const searchClear = function(e) {\r\n        e.preventDefault();\r\n        searchInput.value = '';\r\n        search('');\r\n    };\r\n\r\n    const submitForm = function() {\r\n        // Ensure hidden items are not submitted.\r\n        allCmsPerTopic.forEach(topic => {\r\n            if (!topic.visible && topic.checkbox.checked) {\r\n                topic.checkbox.checked = false;\r\n            }\r\n            topic.cms.forEach(cm => {\r\n                if (!cm.visible && cm.checkbox.checked) {\r\n                    cm.checkbox.checked = false;\r\n                }\r\n            });\r\n        });\r\n        return true;\r\n    };\r\n\r\n    const init = function() {\r\n        searchInput = document.getElementById(IDENTIFIERS.SEARCHINPUT);\r\n        if (!searchInput) {\r\n            return; // Search not available on this page.\r\n        }\r\n        \r\n        searchInput.addEventListener('input', function(e) {\r\n            search(e.target.value.toLowerCase());\r\n        });\r\n        \r\n        const form = document.querySelector(IDENTIFIERS.FORM);\r\n        if (!form) {\r\n            return;\r\n        }\r\n        \r\n        const topics = form.querySelectorAll(IDENTIFIERS.TOPICS);\r\n        resultsHolder = document.getElementById(IDENTIFIERS.RESULTSHOLDER);\r\n        resultsCount = document.getElementById(IDENTIFIERS.RESULTSCOUNT);\r\n        searchClearBtn = document.querySelector(IDENTIFIERS.SEARCHCLEAR);\r\n        \r\n        if (searchClearBtn) {\r\n            searchClearBtn.addEventListener('click', searchClear);\r\n        }\r\n        \r\n        form.addEventListener('submit', submitForm);\r\n        \r\n        topics.forEach(topic => {\r\n            const elements = topic.querySelectorAll(IDENTIFIERS.FORMELEMENTS);\r\n            const topicObj = {\r\n                elem: topic,\r\n                cms: [],\r\n                visible: true,\r\n                checkbox: topic.querySelector(IDENTIFIERS.CHECKBOX)\r\n            };\r\n            \r\n            elements.forEach(element => {\r\n                const title = element.querySelector(IDENTIFIERS.TITLE);\r\n                if (title) {\r\n                    const cmObj = {\r\n                        title: title.textContent.toLowerCase(),\r\n                        elem: element,\r\n                        visible: true,\r\n                        checkbox: element.querySelector(IDENTIFIERS.CHECKBOX)\r\n                    };\r\n                    topicObj.cms.push(cmObj);\r\n                }\r\n            });\r\n            \r\n            allCmsPerTopic.push(topicObj);\r\n        });\r\n    };\r\n\r\n    return {\r\n        init: init\r\n    };\r\n});"],"names":["define","$","IDENTIFIERS","allCmsPerTopic","resultsHolder","resultsCount","searchClearBtn","searchInput","search","searchValue","showAll","length","resultscount","forEach","topic","foundInTopic","cms","cm","title","indexOf","visible","elem","classList","remove","add","textContent","searchClear","e","preventDefault","value","submitForm","checkbox","checked","init","document","getElementById","addEventListener","target","toLowerCase","form","querySelector","topics","querySelectorAll","elements","topicObj","element","cmObj","push"],"mappings":";;;;;;;AAsBAA,qCAAO,CAAC,WAAW,SAASC,SAElBC,wBACW,8BADXA,iBAEI,0BAFJA,yBAGY,SAHZA,mBAIM,cAJNA,qBAKQ,yBALRA,kBAMK,oCANLA,0BAOa,gCAPbA,yBAQY,sCARZA,wBASW,+BAGXC,eAAiB,OACnBC,cAAgB,KAChBC,aAAe,KACfC,eAAiB,KACjBC,YAAc,WAEZC,OAAS,SAASC,mBACdC,QAAiC,IAAvBD,YAAYE,WACxBC,aAAe,EAEnBT,eAAeU,SAAQC,YACfC,cAAe,EACnBD,MAAME,IAAIH,SAAQI,KACVA,GAAGC,MAAMC,QAAQV,cAAgB,GAAKC,SACtCK,cAAe,EACfH,eACAK,GAAGG,SAAU,EACbH,GAAGI,KAAKC,UAAUC,OAAO,YAEzBN,GAAGG,SAAU,EACbH,GAAGI,KAAKC,UAAUE,IAAI,cAI1BT,cACAD,MAAMM,SAAU,EAChBN,MAAMO,KAAKC,UAAUC,OAAO,YAE5BT,MAAMM,SAAU,EAChBN,MAAMO,KAAKC,UAAUE,IAAI,cAI5Bd,SAKDN,cAAckB,UAAUE,IAAI,UAC5BlB,eAAegB,UAAUE,IAAI,YAL7BnB,aAAaoB,YAAcb,aAC3BR,cAAckB,UAAUC,OAAO,UAC/BjB,eAAegB,UAAUC,OAAO,YAOlCG,YAAc,SAASC,GACzBA,EAAEC,iBACFrB,YAAYsB,MAAQ,GACpBrB,OAAO,KAGLsB,WAAa,kBAEf3B,eAAeU,SAAQC,SACdA,MAAMM,SAAWN,MAAMiB,SAASC,UACjClB,MAAMiB,SAASC,SAAU,GAE7BlB,MAAME,IAAIH,SAAQI,MACTA,GAAGG,SAAWH,GAAGc,SAASC,UAC3Bf,GAAGc,SAASC,SAAU,UAI3B,SAuDJ,CACHC,KArDS,cACT1B,YAAc2B,SAASC,eAAejC,0BACjCK,mBAILA,YAAY6B,iBAAiB,SAAS,SAAST,GAC3CnB,OAAOmB,EAAEU,OAAOR,MAAMS,wBAGpBC,KAAOL,SAASM,cAActC,sBAC/BqC,kBAICE,OAASF,KAAKG,iBAAiBxC,oBACrCE,cAAgB8B,SAASC,eAAejC,2BACxCG,aAAe6B,SAASC,eAAejC,0BACvCI,eAAiB4B,SAASM,cAActC,yBAEpCI,gBACAA,eAAe8B,iBAAiB,QAASV,aAG7Ca,KAAKH,iBAAiB,SAAUN,YAEhCW,OAAO5B,SAAQC,cACL6B,SAAW7B,MAAM4B,iBAAiBxC,0BAClC0C,SAAW,CACbvB,KAAMP,MACNE,IAAK,GACLI,SAAS,EACTW,SAAUjB,MAAM0B,cAActC,uBAGlCyC,SAAS9B,SAAQgC,gBACP3B,MAAQ2B,QAAQL,cAActC,sBAChCgB,MAAO,OACD4B,MAAQ,CACV5B,MAAOA,MAAMO,YAAYa,cACzBjB,KAAMwB,QACNzB,SAAS,EACTW,SAAUc,QAAQL,cAActC,uBAEpC0C,SAAS5B,IAAI+B,KAAKD,WAI1B3C,eAAe4C,KAAKH"}