{"version":3,"file":"search.min.js","sources":["../src/search.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Search functionality for download center\n *\n * @module     local_downloadcenter/search\n * @copyright  2025 Original: Academic Moodle Cooperation\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine([], function() {\n    'use strict';\n\n    const IDENTIFIERS = {\n        SEARCHINPUT: 'downloadcenter-search-input',\n        FORM: '#region-main form.mform',\n        FORMELEMENTS: '.fitem',\n        TOPICS: '.card.block',\n        CHECKBOX: 'input[type=\"checkbox\"]',\n        TITLE: 'label .itemtitle span:not(.badge)',\n        RESULTSHOLDER: 'downloadcenter-search-results',\n        RESULTSCOUNT: 'downloadcenter-search-results-count',\n        SEARCHCLEAR: '#downloadcenter-search-clear'\n    };\n\n    const allCmsPerTopic = [];\n    let resultsHolder = null;\n    let resultsCount = null;\n    let searchClearBtn = null;\n    let searchInput = null;\n\n    const search = function(searchValue) {\n        const showAll = searchValue.length === 0;\n        let resultscount = 0;\n        \n        allCmsPerTopic.forEach(topic => {\n            let foundInTopic = false;\n            topic.cms.forEach(cm => {\n                if (cm.title.indexOf(searchValue) > -1 || showAll) {\n                    foundInTopic = true;\n                    resultscount++;\n                    cm.visible = true;\n                    cm.elem.classList.remove('d-none');\n                } else {\n                    cm.visible = false;\n                    cm.elem.classList.add('d-none');\n                }\n            });\n            \n            if (foundInTopic) {\n                topic.visible = true;\n                topic.elem.classList.remove('d-none');\n            } else {\n                topic.visible = false;\n                topic.elem.classList.add('d-none');\n            }\n        });\n        \n        if (!showAll) {\n            resultsCount.textContent = resultscount;\n            resultsHolder.classList.remove('d-none');\n            searchClearBtn.classList.remove('d-none');\n        } else {\n            resultsHolder.classList.add('d-none');\n            searchClearBtn.classList.add('d-none');\n        }\n    };\n\n    const searchClear = function(e) {\n        e.preventDefault();\n        searchInput.value = '';\n        search('');\n    };\n\n    const submitForm = function() {\n        // Ensure hidden items are not submitted.\n        allCmsPerTopic.forEach(topic => {\n            if (!topic.visible && topic.checkbox.checked) {\n                topic.checkbox.checked = false;\n            }\n            topic.cms.forEach(cm => {\n                if (!cm.visible && cm.checkbox.checked) {\n                    cm.checkbox.checked = false;\n                }\n            });\n        });\n        return true;\n    };\n\n    const init = function() {\n        searchInput = document.getElementById(IDENTIFIERS.SEARCHINPUT);\n        if (!searchInput) {\n            return; // Search not available on this page.\n        }\n        \n        searchInput.addEventListener('input', function(e) {\n            search(e.target.value.toLowerCase());\n        });\n        \n        const form = document.querySelector(IDENTIFIERS.FORM);\n        if (!form) {\n            return;\n        }\n        \n        const topics = form.querySelectorAll(IDENTIFIERS.TOPICS);\n        resultsHolder = document.getElementById(IDENTIFIERS.RESULTSHOLDER);\n        resultsCount = document.getElementById(IDENTIFIERS.RESULTSCOUNT);\n        searchClearBtn = document.querySelector(IDENTIFIERS.SEARCHCLEAR);\n        \n        if (searchClearBtn) {\n            searchClearBtn.addEventListener('click', searchClear);\n        }\n        \n        form.addEventListener('submit', submitForm);\n        \n        topics.forEach(topic => {\n            const elements = topic.querySelectorAll(IDENTIFIERS.FORMELEMENTS);\n            const topicObj = {\n                elem: topic,\n                cms: [],\n                visible: true,\n                checkbox: topic.querySelector(IDENTIFIERS.CHECKBOX)\n            };\n            \n            elements.forEach(element => {\n                const title = element.querySelector(IDENTIFIERS.TITLE);\n                if (title) {\n                    const cmObj = {\n                        title: title.textContent.toLowerCase(),\n                        elem: element,\n                        visible: true,\n                        checkbox: element.querySelector(IDENTIFIERS.CHECKBOX)\n                    };\n                    topicObj.cms.push(cmObj);\n                }\n            });\n            \n            allCmsPerTopic.push(topicObj);\n        });\n    };\n\n    return {\n        init: init\n    };\n});\n"],"names":["define","IDENTIFIERS","allCmsPerTopic","resultsHolder","resultsCount","searchClearBtn","searchInput","search","searchValue","showAll","length","resultscount","forEach","topic","foundInTopic","cms","cm","title","indexOf","visible","elem","classList","remove","add","textContent","searchClear","e","preventDefault","value","submitForm","checkbox","checked","init","document","getElementById","addEventListener","target","toLowerCase","form","querySelector","topics","querySelectorAll","elements","topicObj","element","cmObj","push"],"mappings":";;;;;;;AAsBAA,qCAAO,IAAI,iBAGDC,wBACW,8BADXA,iBAEI,0BAFJA,yBAGY,SAHZA,mBAIM,cAJNA,qBAKQ,yBALRA,kBAMK,oCANLA,0BAOa,gCAPbA,yBAQY,sCARZA,wBASW,+BAGXC,eAAiB,OACnBC,cAAgB,KAChBC,aAAe,KACfC,eAAiB,KACjBC,YAAc,WAEZC,OAAS,SAASC,mBACdC,QAAiC,IAAvBD,YAAYE,WACxBC,aAAe,EAEnBT,eAAeU,SAAQC,YACfC,cAAe,EACnBD,MAAME,IAAIH,SAAQI,KACVA,GAAGC,MAAMC,QAAQV,cAAgB,GAAKC,SACtCK,cAAe,EACfH,eACAK,GAAGG,SAAU,EACbH,GAAGI,KAAKC,UAAUC,OAAO,YAEzBN,GAAGG,SAAU,EACbH,GAAGI,KAAKC,UAAUE,IAAI,cAI1BT,cACAD,MAAMM,SAAU,EAChBN,MAAMO,KAAKC,UAAUC,OAAO,YAE5BT,MAAMM,SAAU,EAChBN,MAAMO,KAAKC,UAAUE,IAAI,cAI5Bd,SAKDN,cAAckB,UAAUE,IAAI,UAC5BlB,eAAegB,UAAUE,IAAI,YAL7BnB,aAAaoB,YAAcb,aAC3BR,cAAckB,UAAUC,OAAO,UAC/BjB,eAAegB,UAAUC,OAAO,YAOlCG,YAAc,SAASC,GACzBA,EAAEC,iBACFrB,YAAYsB,MAAQ,GACpBrB,OAAO,KAGLsB,WAAa,kBAEf3B,eAAeU,SAAQC,SACdA,MAAMM,SAAWN,MAAMiB,SAASC,UACjClB,MAAMiB,SAASC,SAAU,GAE7BlB,MAAME,IAAIH,SAAQI,MACTA,GAAGG,SAAWH,GAAGc,SAASC,UAC3Bf,GAAGc,SAASC,SAAU,UAI3B,SAuDJ,CACHC,KArDS,cACT1B,YAAc2B,SAASC,eAAejC,0BACjCK,mBAILA,YAAY6B,iBAAiB,SAAS,SAAST,GAC3CnB,OAAOmB,EAAEU,OAAOR,MAAMS,wBAGpBC,KAAOL,SAASM,cAActC,sBAC/BqC,kBAICE,OAASF,KAAKG,iBAAiBxC,oBACrCE,cAAgB8B,SAASC,eAAejC,2BACxCG,aAAe6B,SAASC,eAAejC,0BACvCI,eAAiB4B,SAASM,cAActC,yBAEpCI,gBACAA,eAAe8B,iBAAiB,QAASV,aAG7Ca,KAAKH,iBAAiB,SAAUN,YAEhCW,OAAO5B,SAAQC,cACL6B,SAAW7B,MAAM4B,iBAAiBxC,0BAClC0C,SAAW,CACbvB,KAAMP,MACNE,IAAK,GACLI,SAAS,EACTW,SAAUjB,MAAM0B,cAActC,uBAGlCyC,SAAS9B,SAAQgC,gBACP3B,MAAQ2B,QAAQL,cAActC,sBAChCgB,MAAO,OACD4B,MAAQ,CACV5B,MAAOA,MAAMO,YAAYa,cACzBjB,KAAMwB,QACNzB,SAAS,EACTW,SAAUc,QAAQL,cAActC,uBAEpC0C,SAAS5B,IAAI+B,KAAKD,WAI1B3C,eAAe4C,KAAKH"}