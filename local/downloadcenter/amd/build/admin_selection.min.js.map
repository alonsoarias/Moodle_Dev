{"version":3,"file":"admin_selection.min.js","sources":["../src/admin_selection.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Admin selection JavaScript for download center\n *\n * @module     local_downloadcenter/admin_selection\n * @copyright  2025 Alonso Arias <soporte@ingeweb.co>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine(['jquery', 'core/ajax', 'core/notification', 'core/str'], \n    function($, Ajax, Notification, Str) {\n    \n    const AdminSelection = function() {\n        this.init();\n    };\n    \n    AdminSelection.prototype.init = function() {\n        const self = this;\n        \n        // Handle course checkbox changes.\n        $(document).on('change', '.course-selector input[type=\"checkbox\"]', function() {\n            const courseid = $(this).data('courseid');\n            const selected = $(this).is(':checked');\n            self.toggleCourse(courseid, selected);\n        });\n        \n        // Handle download options changes.\n        $(document).on('change', '#downloadoptions input[type=\"checkbox\"]', function() {\n            self.saveOptions();\n        });\n        \n        // Category collapse/expand.\n        $(document).on('click', '.category-header', function() {\n            const $category = $(this).closest('.category-container');\n            $category.find('.category-courses').slideToggle();\n            $(this).find('.fa').toggleClass('fa-chevron-down fa-chevron-up');\n        });\n        \n        // Update selection count.\n        this.updateSelectionCount();\n        \n        // Initialize tooltips.\n        $('[data-toggle=\"tooltip\"]').tooltip();\n    };\n    \n    AdminSelection.prototype.toggleCourse = function(courseid, selected) {\n        const self = this;\n        \n        $.ajax({\n            url: M.cfg.wwwroot + '/local/downloadcenter/index.php',\n            type: 'POST',\n            data: {\n                action: 'togglecourse',\n                courseid: courseid,\n                selected: selected ? 1 : 0,\n                sesskey: M.cfg.sesskey\n            },\n            success: function(response) {\n                self.updateSelectionCount();\n                \n                // Update visual feedback.\n                const $checkbox = $('input[data-courseid=\"' + courseid + '\"]');\n                const $label = $checkbox.closest('label');\n                \n                if (selected) {\n                    $label.addClass('selected');\n                } else {\n                    $label.removeClass('selected');\n                }\n            },\n            error: function() {\n                Notification.exception(new Error('Failed to update selection'));\n            }\n        });\n    };\n    \n    AdminSelection.prototype.saveOptions = function() {\n        const options = {\n            excludestudent: $('#id_excludestudent').is(':checked') ? 1 : 0,\n            includefiles: $('#id_includefiles').is(':checked') ? 1 : 0,\n            filesrealnames: $('#id_filesrealnames').is(':checked') ? 1 : 0,\n            addnumbering: $('#id_addnumbering').is(':checked') ? 1 : 0\n        };\n        \n        $.ajax({\n            url: M.cfg.wwwroot + '/local/downloadcenter/index.php',\n            type: 'POST',\n            data: Object.assign({\n                action: 'updateoptions',\n                sesskey: M.cfg.sesskey\n            }, options),\n            success: function() {\n                // Show temporary success message.\n                const $feedback = $('#options-feedback');\n                if ($feedback.length === 0) {\n                    $('<div id=\"options-feedback\" class=\"alert alert-success\">' +\n                      'Options saved' + '</div>')\n                      .insertAfter('#downloadoptions')\n                      .delay(2000)\n                      .fadeOut();\n                } else {\n                    $feedback.show().delay(2000).fadeOut();\n                }\n            },\n            error: function() {\n                Notification.exception(new Error('Failed to save options'));\n            }\n        });\n    };\n    \n    AdminSelection.prototype.updateSelectionCount = function() {\n        const count = $('.course-selector input[type=\"checkbox\"]:checked').length;\n        $('.selection-count').text(count);\n        \n        // Enable/disable download button.\n        if (count > 0) {\n            $('#download-selection').prop('disabled', false);\n        } else {\n            $('#download-selection').prop('disabled', true);\n        }\n    };\n    \n    return {\n        init: function() {\n            return new AdminSelection();\n        }\n    };\n});\n"],"names":["define","$","Ajax","Notification","Str","AdminSelection","init","prototype","self","this","document","on","courseid","data","selected","is","toggleCourse","saveOptions","closest","find","slideToggle","toggleClass","updateSelectionCount","tooltip","ajax","url","M","cfg","wwwroot","type","action","sesskey","success","response","$label","addClass","removeClass","error","exception","Error","options","excludestudent","includefiles","filesrealnames","addnumbering","Object","assign","$feedback","length","insertAfter","delay","fadeOut","show","count","text","prop"],"mappings":";;;;;;;AAsBAA,8CAAO,CAAC,SAAU,YAAa,oBAAqB,aAChD,SAASC,EAAGC,KAAMC,aAAcC,WAE1BC,eAAiB,gBACdC,eAGTD,eAAeE,UAAUD,KAAO,iBACtBE,KAAOC,KAGbR,EAAES,UAAUC,GAAG,SAAU,2CAA2C,iBAC1DC,SAAWX,EAAEQ,MAAMI,KAAK,YACxBC,SAAWb,EAAEQ,MAAMM,GAAG,YAC5BP,KAAKQ,aAAaJ,SAAUE,aAIhCb,EAAES,UAAUC,GAAG,SAAU,2CAA2C,WAChEH,KAAKS,iBAIThB,EAAES,UAAUC,GAAG,QAAS,oBAAoB,WACtBV,EAAEQ,MAAMS,QAAQ,uBACxBC,KAAK,qBAAqBC,cACpCnB,EAAEQ,MAAMU,KAAK,OAAOE,YAAY,yCAI/BC,uBAGLrB,EAAE,2BAA2BsB,WAGjClB,eAAeE,UAAUS,aAAe,SAASJ,SAAUE,gBACjDN,KAAOC,KAEbR,EAAEuB,KAAK,CACHC,IAAKC,EAAEC,IAAIC,QAAU,kCACrBC,KAAM,OACNhB,KAAM,CACFiB,OAAQ,eACRlB,SAAUA,SACVE,SAAUA,SAAW,EAAI,EACzBiB,QAASL,EAAEC,IAAII,SAEnBC,QAAS,SAASC,UACdzB,KAAKc,6BAICY,OADYjC,EAAE,wBAA0BW,SAAW,MAChCM,QAAQ,SAE7BJ,SACAoB,OAAOC,SAAS,YAEhBD,OAAOE,YAAY,aAG3BC,MAAO,WACHlC,aAAamC,UAAU,IAAIC,MAAM,mCAK7ClC,eAAeE,UAAUU,YAAc,iBAC7BuB,QAAU,CACZC,eAAgBxC,EAAE,sBAAsBc,GAAG,YAAc,EAAI,EAC7D2B,aAAczC,EAAE,oBAAoBc,GAAG,YAAc,EAAI,EACzD4B,eAAgB1C,EAAE,sBAAsBc,GAAG,YAAc,EAAI,EAC7D6B,aAAc3C,EAAE,oBAAoBc,GAAG,YAAc,EAAI,GAG7Dd,EAAEuB,KAAK,CACHC,IAAKC,EAAEC,IAAIC,QAAU,kCACrBC,KAAM,OACNhB,KAAMgC,OAAOC,OAAO,CAChBhB,OAAQ,gBACRC,QAASL,EAAEC,IAAII,SAChBS,SACHR,QAAS,iBAECe,UAAY9C,EAAE,qBACK,IAArB8C,UAAUC,OACV/C,EAAE,8EAECgD,YAAY,oBACZC,MAAM,KACNC,UAEHJ,UAAUK,OAAOF,MAAM,KAAMC,WAGrCd,MAAO,WACHlC,aAAamC,UAAU,IAAIC,MAAM,+BAK7ClC,eAAeE,UAAUe,qBAAuB,iBACtC+B,MAAQpD,EAAE,mDAAmD+C,OACnE/C,EAAE,oBAAoBqD,KAAKD,OAGvBA,MAAQ,EACRpD,EAAE,uBAAuBsD,KAAK,YAAY,GAE1CtD,EAAE,uBAAuBsD,KAAK,YAAY,IAI3C,CACHjD,KAAM,kBACK,IAAID"}