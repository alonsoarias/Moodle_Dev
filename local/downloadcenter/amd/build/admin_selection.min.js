/**
 * Admin selection JavaScript for download center
 *
 * @module     local_downloadcenter/admin_selection
 * @copyright  2025 Alonso Arias <soporte@ingeweb.co>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("local_downloadcenter/admin_selection",["core/ajax","core/notification","core/str"],(function(Ajax,Notification,Str){const AdminSelection=function(){this.init()};return AdminSelection.prototype.init=function(){const self=this;document.addEventListener("change",(function(e){if(e.target.matches('.course-selector input[type="checkbox"]')){const courseid=e.target.dataset.courseid,selected=e.target.checked;self.toggleCourse(courseid,selected)}})),document.addEventListener("change",(function(e){e.target.matches('#downloadoptions input[type="checkbox"]')&&self.saveOptions()})),document.addEventListener("click",(function(e){if(e.target.closest(".category-header")){const categoryHeader=e.target.closest(".category-header"),categoryCoursesDiv=categoryHeader.closest(".category-container").querySelector(".category-courses"),chevronIcon=categoryHeader.querySelector(".fa");categoryCoursesDiv&&("none"!==categoryCoursesDiv.style.display&&categoryCoursesDiv.style.display?categoryCoursesDiv.style.display="none":categoryCoursesDiv.style.display="block",chevronIcon&&(chevronIcon.classList.toggle("fa-chevron-down"),chevronIcon.classList.toggle("fa-chevron-up")))}})),this.updateSelectionCount()},AdminSelection.prototype.toggleCourse=function(courseid,selected){const self=this,xhr=new XMLHttpRequest;xhr.open("POST",M.cfg.wwwroot+"/local/downloadcenter/index.php",!0),xhr.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),xhr.onload=function(){if(200===xhr.status){self.updateSelectionCount();const checkbox=document.querySelector('input[data-courseid="'+courseid+'"]'),label=checkbox?checkbox.closest("label"):null;label&&(selected?label.classList.add("selected"):label.classList.remove("selected"))}else Notification.exception(new Error("Failed to update selection"))},xhr.onerror=function(){Notification.exception(new Error("Failed to update selection"))};const params="action=togglecourse&courseid="+courseid+"&selected="+(selected?1:0)+"&sesskey="+M.cfg.sesskey;xhr.send(params)},AdminSelection.prototype.saveOptions=function(){const excludeStudentCheckbox=document.getElementById("id_excludestudent"),includeFilesCheckbox=document.getElementById("id_includefiles"),filesRealNamesCheckbox=document.getElementById("id_filesrealnames"),addNumberingCheckbox=document.getElementById("id_addnumbering"),options={excludestudent:excludeStudentCheckbox&&excludeStudentCheckbox.checked?1:0,includefiles:includeFilesCheckbox&&includeFilesCheckbox.checked?1:0,filesrealnames:filesRealNamesCheckbox&&filesRealNamesCheckbox.checked?1:0,addnumbering:addNumberingCheckbox&&addNumberingCheckbox.checked?1:0},xhr=new XMLHttpRequest;xhr.open("POST",M.cfg.wwwroot+"/local/downloadcenter/index.php",!0),xhr.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),xhr.onload=function(){if(200===xhr.status){let feedback=document.getElementById("options-feedback");if(feedback)feedback.style.display="block";else{feedback=document.createElement("div"),feedback.id="options-feedback",feedback.className="alert alert-success",feedback.textContent="Options saved";const downloadOptions=document.getElementById("downloadoptions");downloadOptions&&downloadOptions.parentNode&&downloadOptions.parentNode.insertBefore(feedback,downloadOptions.nextSibling)}setTimeout((function(){feedback&&(feedback.style.display="none")}),2e3)}else Notification.exception(new Error("Failed to save options"))},xhr.onerror=function(){Notification.exception(new Error("Failed to save options"))};let params="action=updateoptions&sesskey="+M.cfg.sesskey;Object.keys(options).forEach((function(key){params+="&"+key+"="+options[key]})),xhr.send(params)},AdminSelection.prototype.updateSelectionCount=function(){const count=document.querySelectorAll('.course-selector input[type="checkbox"]:checked').length;document.querySelectorAll(".selection-count").forEach((function(elem){elem.textContent=count}));const downloadButton=document.getElementById("download-selection");downloadButton&&(downloadButton.disabled=0===count)},{init:function(){return new AdminSelection}}}));

//# sourceMappingURL=admin_selection.min.js.map